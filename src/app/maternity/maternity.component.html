<div id="page-toshow" style="padding-top: 10px;">
    <h1 class="page-title text-center">פרויקטים</h1>
    <div class="row">
        <div class="col-3">
            <div class="container-fluid" dir="rtl">
                <div class="row" style="justify-content: center;">
                    <h4 class="text-center">
                        <b>{{NewPatientsAlertList.length}} יולדות במחלקה</b>
                    </h4>
                    <div class="list-of-new">
                        <mat-card *ngFor="let newOne of NewPatientsAlertList">
                            <p><span class="material-icons" id="alertIcon" style="color: red;float: right;"
                                    *ngIf="newOne.Read == 'False'" matTooltip="סמן כנקרא"
                                    (click)="setAlertToRead(newOne.Row_ID)">
                                    notifications_active
                                </span>ת.ז: {{newOne.PatientID}} - שם מלא:
                                {{newOne.PM_LAST_NAME}},
                                {{newOne.PM_FIRST_NAME}} <br> נייד: {{newOne.PM_PATIENT_PHONE_NUMBER_1}} </p>

                        </mat-card>
                    </div>
                    <!-- <h4><b>{{NewPatientsAlertList.length}} יולדות חדשות - לצפייה:</b> <button class="row-data mr-2"
                            mat-raised-button color="primary" [disabled]="userName != 'adahabre'">
                            <span class="material-icons">
                                view_list
                            </span>
                        </button></h4> -->
                </div>
            </div>
        </div>
        <div class="col-9">
            <div class="container-fluid">
                <div class="row">
                    <div class="col">
                        <div dir="rtl" class="card w-85-p">
                            <div dir="rtl" class="card-body">
                                <form class="form">
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <mat-form-field>
                                                    <input matInput autocomplete="off" placeholder="חפש"
                                                        [(ngModel)]="fliterVal" name="fliterVal" />
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <mat-form-field>
                                                    <mat-label>מצב</mat-label>
                                                    <mat-select [(value)]="activeOrNot">
                                                        <mat-option value="-1">הכל</mat-option>
                                                        <mat-option value="1">פעיל</mat-option>
                                                        <mat-option value="0">לא פעיל</mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                    <button mat-raised-button type="submit" class="btn btn-primary btn-raised"
                                        (click)="getTableFromServer('','1','')">
                                        חפש
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button mat-raised-button type="submit" class="btn btn-primary btn-raised" (click)="returnToCards()"
                style="float: right;margin-right: 1%;">
                חזרה לראשי
            </button>
            <br />
            <hr />
            <div class="container-fluid pb-60" style="width: 88%;">
                <div class="row">
                    <div class="col-4" dir="rtl" *ngFor="let act of MaternityActivityList"
                        [hidden]="dataSource.filteredData.length > 0">
                        <mat-card class="card activity" (click)="getTableFromServer('','1',act.Row_ID)">
                            <span style="font-size: 28px;">{{act.Activity_Name}}</span>
                        </mat-card>
                    </div>
                    <div dir="rtl" class="col" *ngIf="dataSource.filteredData.length > 0">
                        <div class="table-responsive">
                            <div class="table-spinner-container">
                                <!-- <mat-form-field>
                                        <input matInput (keyup)="applyFilter($event.target.value)" placeholder="חפש">
                                    </mat-form-field> -->
                                <table class="table" mat-table [dataSource]="dataSource">
                                    <ng-container matColumnDef="RowID">
                                        <th mat-header-cell *matHeaderCellDef>
                                            מס' פרויקט
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.MaternityNumber }}
                                        </td>
                                    </ng-container>
                                    <!-- <ng-container matColumnDef="MaternityNumber">
                                        <th mat-header-cell *matHeaderCellDef>
                                            מזהה פרויקט
                                        </th>
                                        <td mat-cell *matCellDef="let element" class="text-center">
                                            {{ element.RowID }}
                                        </td>
                                    </ng-container> -->
                                    <ng-container matColumnDef="MaternityName">
                                        <th mat-header-cell *matHeaderCellDef width="160">
                                            שם פרויקט
                                        </th>
                                        <td mat-cell *matCellDef="let element" class="text-center">
                                            {{ element.MaternityName }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="ProjectDate">
                                        <th mat-header-cell *matHeaderCellDef>
                                            תאריך הפרויקט
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.ProjectDate }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="ProjectLocation">
                                        <th mat-header-cell *matHeaderCellDef>
                                            מיקום
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.Location }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="ProjectCost">
                                        <th mat-header-cell *matHeaderCellDef>
                                            עלות הפרויקט
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.ProjectCost }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="MaternityStatus">
                                        <th mat-header-cell *matHeaderCellDef>מצב</th>
                                        <td mat-cell *matCellDef="let element">
                                            {{
                                            element.MaternityStatus == 1
                                            ? "פעיל"
                                            : "לא פעיל"
                                            }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="CLICK_PROJ_CHILD">
                                        <th mat-header-cell *matHeaderCellDef>
                                            תתי פרויקטים
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            <div class="example-button-container">
                                                <button class="row-data" mat-mini-fab color="primary"
                                                    (click)="open(subProjects, 'maternity', element.MaternityName); getChildrenProjects(element.RowID)">
                                                    <span class="material-icons">
                                                        view_list
                                                    </span>
                                                </button>
                                            </div>
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="CLICK">
                                        <th mat-header-cell *matHeaderCellDef>
                                            עריכה
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            <div class="example-button-container">
                                                <button (click)="
                                                        editRow(
                                                            maternityModal,
                                                            'maternity',
                                                            element
                                                        ); getParentProjects();
                                                    " class="row-data" mat-mini-fab color="primary">
                                                    <mat-icon>create</mat-icon>
                                                </button>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="CLICK_PATIENT">
                                        <th mat-header-cell *matHeaderCellDef>
                                            מטופלות
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            <div class="example-button-container">
                                                <button (click)="
                                                        showPatient(
                                                            PatientModal,
                                                            'PatientDetails',
                                                            element
                                                        )
                                                    " class="row-data" mat-mini-fab color="primary">
                                                    <mat-icon>night_shelter</mat-icon>
                                                </button>
                                            </div>
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="SEND_SMS_PATIENT">
                                        <th mat-header-cell *matHeaderCellDef>
                                            שליחת SMS
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            <div class="example-button-container">
                                                <button *ngIf="element.MaternityStatus == 1" (click)="
                                                        SendSmsToPatient(
                                                            SendSmsToPatientModal,
                                                            'SendSmsToPatientDetails',
                                                            element
                                                        )
                                                    " class="row-data" mat-mini-fab color="primary">
                                                    <mat-icon>textsms</mat-icon>
                                                </button>
                                            </div>
                                        </td>
                                    </ng-container>
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                                </table>
                            </div>
                            <!-- PAGINATION -->
                            <mat-paginator [length]="resultsLength" [pageSizeOptions]="[5, 10, 20, 50, 100]"
                                [pageSize]="10" showFirstLastButtons></mat-paginator>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>
<button type="button" id="maternityBtn" (click)="open(maternityModal, 'maternity', ''); getParentProjects();" mat-fab
    color="primary">
    <i class="material-icons">add</i>
</button>

<ng-template #subProjects let-modal>
    <form dir="rtl" id="maternityFormID" class="form col" [formGroup]="maternityForm">
        <div class="modal-header text-right">
            <h4 class="modal-title text-center"><span class="d-none1">תתי פרויקטים של - </span><span>{{
                    ParentProjectName
                    }}</span>
            </h4>
            <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <table class="table" dir="rtl">
                <thead>
                    <tr>
                        <th scope="col">תיאור פרויקט</th>
                        <th scope="col">עלות</th>
                        <th scope="col">עריכה</th>
                        <th scope="col">מטופלות</th>
                        <th scope="col">שליחת SMS</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let subProj of ChildrenProjectsList">
                        <td>{{subProj.MaternityName}}</td>
                        <td>{{subProj.ProjectCost}}</td>
                        <td>
                            <div class="example-button-container">
                                <button class="row-data" mat-mini-fab color="primary"
                                    (click)="editRow(maternityModal,'subProjEdit',subProj); getParentProjects();">
                                    <mat-icon>create</mat-icon>
                                </button>
                            </div>
                        </td>
                        <td>
                            <div class="example-button-container">
                                <button (click)="
                                            showPatient(
                                                PatientModal,
                                                'PatientDetails',
                                                subProj
                                            )
                                        " class="row-data" mat-mini-fab color="primary">
                                    <mat-icon>night_shelter</mat-icon>
                                </button>
                            </div>
                        </td>
                        <td>
                            <div class="example-button-container">
                                <button *ngIf="subProj.MaternityStatus == 1" (click)="
                                            SendSmsToPatient(
                                                SendSmsToPatientModal,
                                                'SendSmsToPatientDetails',
                                                subProj
                                            )
                                        " class="row-data" mat-mini-fab color="primary">
                                    <mat-icon>textsms</mat-icon>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </form>
    <button type="button" id="submaternityBtn" (click)="open(maternityModal, 'maternity', ''); getParentProjects();"
        mat-fab color="primary">
        <i class="material-icons">add</i>
    </button>
</ng-template>

<ng-template #maternityModal let-modal>
    <form dir="rtl" id="maternityFormID" class="form col" [formGroup]="maternityForm" (ngSubmit)="onSubmit()">
        <div class="modal-header text-right">
            <h4 class="modal-title text-center">
                פרויקט <span class="d-none1">{{ MaternityNumber }}</span> -
                <span>{{ MaternityName }}</span>
            </h4>
            <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput autocomplete="off" class="form-control" placeholder="מס' פרויקט"
                                formControlName="MaternityNumber" required type="text" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput autocomplete="off" class="form-control" placeholder="שם פרויקט"
                                formControlName="MaternityName" required type="text" />
                        </mat-form-field>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput autocomplete="off" class="form-control" placeholder="עלות הפרויקט"
                                formControlName="ProjectCost" required step="any" type="number" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group lh-37">
                        <mat-form-field>
                            <mat-label>מצב</mat-label>
                            <mat-select formControlName="MaternityStatus">
                                <mat-option value="1">פעיל</mat-option>
                                <mat-option value="0">לא פעיל</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <section class="example-section text-center">
                        <mat-checkbox class="example-margin" [(ngModel)]="parentCheckBox"
                            [ngModelOptions]="{standalone: true}" (change)="parentCheckFunc($event.checked)">פרויקט אב?
                        </mat-checkbox>
                    </section>
                    <div class="form-group lh-37" [ngStyle]="{'display': parentCheckBox ? 'none' : 'block' }">
                        <mat-form-field>
                            <mat-label>בחר פרויקט אב</mat-label>
                            <mat-select formControlName="ParentProject">
                                <mat-option *ngFor="let proj of ParentProjectsList" [value]="proj.RowID">
                                    {{proj.MaternityName}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput formControlName="ProjectDate" placeholder="תאריך קורס/מפגש"
                                [matDatepicker]="picker" (focus)="picker.open()">
                            <mat-datepicker-toggle matSuffix [for]="picker">
                            </mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input type="time" matInput formControlName="StartProjectTime" placeholder="שעת תחילה"
                                class="form-control" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input type="time" matInput formControlName="EndProjectTime" placeholder="שעת סיום"
                                class="form-control" />
                        </mat-form-field>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput autocomplete="off" class="form-control" placeholder="שם מנחה"
                                formControlName="ModeratorName" step="any" type="text" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput autocomplete="off" class="form-control" placeholder="מיקום"
                                formControlName="Location" step="any" type="text" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput formControlName="additionalProjectDate" placeholder="תאריך קורס/מפגש נוסף"
                                [matDatepicker]=" picker2" (focus)="picker2.open()">
                            <mat-datepicker-toggle matSuffix [for]="picker2">
                            </mat-datepicker-toggle>
                            <mat-datepicker #picker2></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer text-left">
            <button type="submit" class="btn btn-outline-dark" [disabled]="!maternityForm.valid">שמור</button>
        </div>
    </form>
</ng-template>

<ng-template #PatientModal let-modal>
    <app-maternitypatients></app-maternitypatients>
</ng-template>

<ng-template #SendSmsToPatientModal let-modal>
    <div class="row">
        <div class="col">
            <h1 ngbAutofocus dir="rtl" class="text-right w-85-p">שליחת הודעה לפרוייקט - <span>{{MaternityName +" - "+
                    MaternityNumber}}</span></h1>
            <app-sendsmsadmin (parentFun)="CloseModalSendSms()"></app-sendsmsadmin>
        </div>
    </div>

</ng-template>