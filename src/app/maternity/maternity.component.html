<div id="page-toshow">
    <h1 class="page-title text-center">פרויקטים</h1>
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <div dir="rtl" class="card w-85-p">
                    <div dir="rtl" class="card-body">
                        <form class="form">
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <mat-form-field>
                                            <input matInput autocomplete="off" placeholder="חפש" [(ngModel)]="fliterVal"
                                                name="fliterVal" />
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <mat-form-field>
                                            <mat-label>מצב</mat-label>
                                            <mat-select [(value)]="activeOrNot">
                                                <mat-option value="-1">הכל</mat-option>
                                                <mat-option value="1">פעיל</mat-option>
                                                <mat-option value="0">לא פעיל</mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>

                            <button mat-raised-button type="submit" class="btn btn-primary btn-raised"
                                (click)="getReport($event)">
                                חפש
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br />
    <hr />
    <div class="container-fluid pb-60">
        <div class="row">
            <div dir="rtl" class="col">
                <div class="table-responsive">
                    <div class="table-spinner-container">
                        <!-- <mat-form-field>
                                <input matInput (keyup)="applyFilter($event.target.value)" placeholder="חפש">
                            </mat-form-field> -->
                        <table class="table" mat-table [dataSource]="dataSource">
                            <ng-container matColumnDef="RowID">
                                <th mat-header-cell *matHeaderCellDef>
                                    מס' פרויקט
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.RowID }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="MaternityNumber">
                                <th mat-header-cell *matHeaderCellDef>
                                    מזהה פרויקט
                                </th>
                                <td mat-cell *matCellDef="let element" class="text-center">
                                    {{ element.MaternityNumber }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="MaternityName">
                                <th mat-header-cell *matHeaderCellDef width="160">
                                    שם פרויקט
                                </th>
                                <td mat-cell *matCellDef="let element" class="text-center">
                                    {{ element.MaternityName }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="ProjectCost">
                                <th mat-header-cell *matHeaderCellDef>
                                    עלות הפרויקט
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.ProjectCost }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="MaternityStatus">
                                <th mat-header-cell *matHeaderCellDef>מצב</th>
                                <td mat-cell *matCellDef="let element">
                                    {{
                                    element.MaternityStatus == 1
                                    ? "פעיל"
                                    : "לא פעיל"
                                    }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="CLICK">
                                <th mat-header-cell *matHeaderCellDef width="50">
                                    עריכה
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="example-button-container">
                                        <button (click)="
                                                editRow(
                                                    maternityModal,
                                                    'maternity',
                                                    element
                                                ); getParentProjects();
                                            " class="row-data" mat-mini-fab color="primary">
                                            <mat-icon>create</mat-icon>
                                        </button>
                                    </div>
                                </td>
                            </ng-container>

                            <ng-container matColumnDef="CLICK_PATIENT">
                                <th mat-header-cell *matHeaderCellDef width="50">
                                    מטופלות
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="example-button-container">
                                        <button (click)="
                                                showPatient(
                                                    PatientModal,
                                                    'PatientDetails',
                                                    element
                                                )
                                            " class="row-data" mat-mini-fab color="primary">
                                            <mat-icon>night_shelter</mat-icon>
                                        </button>
                                    </div>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="SEND_SMS_PATIENT">
                                <th mat-header-cell *matHeaderCellDef width="50">
                                    שליחת SMS
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="example-button-container">
                                        <button *ngIf="element.MaternityStatus == 1" (click)="
                                                SendSmsToPatient(
                                                    SendSmsToPatientModal,
                                                    'SendSmsToPatientDetails',
                                                    element
                                                )
                                            " class="row-data" mat-mini-fab color="primary">
                                            <mat-icon>textsms</mat-icon>
                                        </button>
                                    </div>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                        </table>
                    </div>
                    <!-- PAGINATION -->
                    <mat-paginator [length]="resultsLength" [pageSizeOptions]="[5, 10, 20, 50, 100]" [pageSize]="10"
                        showFirstLastButtons (page)="getPaginatorData($event)"></mat-paginator>
                </div>
            </div>
        </div>
    </div>
</div>
<button type="button" id="maternityBtn" (click)="open(maternityModal, 'maternity', '')" mat-fab color="primary">
    <i class="material-icons">add</i>
</button>
<ng-template #maternityModal let-modal>
    <form dir="rtl" id="maternityFormID" class="form col" [formGroup]="maternityForm" (ngSubmit)="onSubmit()">
        <div class="modal-header text-right">
            <h4 class="modal-title text-center">
                פרויקט <span class="d-none1">{{ MaternityNumber }}</span> -
                <span>{{ MaternityName }}</span>
            </h4>
            <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput autocomplete="off" class="form-control" placeholder="מס' פרויקט"
                                formControlName="MaternityNumber" required type="text" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput autocomplete="off" class="form-control" placeholder="שם פרויקט"
                                formControlName="MaternityName" required type="text" />
                        </mat-form-field>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <mat-form-field>
                            <input matInput autocomplete="off" class="form-control" placeholder="עלות הפרויקט"
                                formControlName="ProjectCost" required step="any" type="number" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group lh-37">
                        <mat-form-field>
                            <mat-label>מצב</mat-label>
                            <mat-select formControlName="MaternityStatus">
                                <mat-option value="1">פעיל</mat-option>
                                <mat-option value="0">לא פעיל</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group lh-37">
                        <mat-form-field>
                            <mat-label>פרויקט אב</mat-label>
                            <mat-select formControlName="ParentProject">
                                <mat-option *ngFor="let proj of ParentProjectsList" [value]="proj.RowID">{{proj.MaternityName}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer text-left">
            <button type="submit" class="btn btn-outline-dark">שמור</button>
        </div>
    </form>
</ng-template>

<ng-template #PatientModal let-modal>
    <app-maternitypatients></app-maternitypatients>
</ng-template>

<ng-template #SendSmsToPatientModal let-modal>
    <div class="row">
        <div class="col">
            <h1 ngbAutofocus dir="rtl" class="text-right w-85-p">שליחת הודעה לפרוייקט - <span>{{MaternityName +" - "+
                    MaternityNumber}}</span></h1>
            <app-sendsmsadmin (parentFun)="CloseModalSendSms()"></app-sendsmsadmin>
        </div>
    </div>

</ng-template>