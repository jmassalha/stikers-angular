<mat-card class="form-amen">
  <form dir="rtl" [formGroup]="surveyForm" autocomplete="off">
    <div class="border-me card-body">
      <div class="row">
        <div class="col-8">
          <mat-form-field class="full-width mt-3">
            <input formControlName="FormName" matInput placeholder="שם טופס" [required]="true">
          </mat-form-field>
        </div>
        <div class="col-4" *ngIf="surveyForm.controls['GeneralForm'].value == '0'">
          <mat-form-field appearance="fill">
            <mat-label>מחלקות</mat-label>
            <mat-select formControlName="FormDepartmentID">
              <mat-option *ngFor="let dept of department" [value]="dept.Row_ID">
                {{dept.Depart_Name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <h3 class="list-title m-3 text-center">יצירת שאלות</h3>
      </div>
      <div class="col">
        <section class="example-section">
          <mat-radio-group>
            <mat-checkbox class="list-title m-3 text-center" formControlName="isCaseNumber">עם מספר מקרה?
            </mat-checkbox>
          </mat-radio-group>
        </section>
      </div>
      <div class="col">
        <section class="example-section">
          <mat-radio-group>
            <mat-checkbox class="list-title m-3 text-center" formControlName="GeneralForm">טופס ארגוני?
            </mat-checkbox>
          </mat-radio-group>
        </section>
      </div>
      <div class="col">
        <section class="example-section">
          <mat-radio-group>
            <mat-checkbox class="list-title m-3 text-center" formControlName="TableForm"> טבלה?
            </mat-checkbox>
          </mat-radio-group>
        </section>
      </div>
    </div>
    <div class="row">
      <mat-form-field class="full-width">
        <textarea matInput formControlName="FormOpenText" type="textarea" cols="15" rows="5"
          placeholder="קטע הנחיות או טקסט פתוח"></textarea>
      </mat-form-field>
    </div>
    <div class="survey-options">
      <div formArrayName="surveyQuestions" class="poll-options">
        <ol class="list-style">
          <div class="row">
            <li class="col-lg-6 col-sm-12"
              *ngFor="let questionCtrl of surveyForm.get('surveyQuestions')['controls']; let i = index">
              <div [formGroupName]="i" class="border-me" *ngIf="questionCtrl.controls['questionStatus'].value == '1'">
                <div class="row">
                  <div class="col-9">
                    <mat-form-field class="full-width">
                      <input formControlName="questionTitle" matInput placeholder="הכנס שאלה" [required]="true">
                    </mat-form-field>
                  </div>
                  <div class="col-3">
                    <mat-form-field class="full-width">
                      <input formControlName="priority" matInput placeholder="מספר שאלה" value="{{i}}" [required]="true">
                    </mat-form-field>
                    <mat-slide-toggle class="example-margin" color="warn" formControlName="IsRequired">שדה חובה*
                    </mat-slide-toggle>
                  </div>
                  <div class="col-12">
                    <mat-form-field class="full-width">
                      <mat-select formControlName="questionType" placeholder="סוג שאלה" ng-model="myVar"
                        [(value)]="selectedOption[i]" (selectionChange)="onSeletQuestionType(selectedOption[i], i)"
                        [required]="true">
                        <mat-option *ngFor="let type of questions" [value]="type.value">
                          {{type.viewValue}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div formGroupName="questionGroup" [ngSwitch]="selectedOption[i]">
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'RadioButton'">

                      <div *ngIf="questionCtrl.controls.questionGroup.controls.options">
                        <ul class="question-type" formArrayName="options">
                          <li
                            *ngFor="let optionCtrl of questionCtrl.controls.questionGroup.controls.options.controls let j = index">
                            <div [formGroupName]="j">
                              <div *ngIf="optionCtrl.controls['optionStatus'].value == '1'">
                                <mat-radio-button [disabled]="true" value="1"></mat-radio-button>
                                <mat-form-field>
                                  <input formControlName="optionText" matInput placeholder="הכנס אפשרות"
                                    [required]="true">
                                </mat-form-field>
                                <button mat-raised-button class="mb-2" *ngIf="j>=2"
                                  (click)="removeOption(optionCtrl,i,j)" color="warn">
                                  X
                                </button>
                              </div>
                            </div>
                          </li>
                        </ul>
                        <button mat-raised-button type="button" (click)="addOption(i)"
                          class="mat-sm-button add-option-btn" color="accent"> <span class="material-icons">
                            playlist_add
                          </span></button>
                      </div>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'CheckBox'">

                      <div *ngIf="questionCtrl.controls.questionGroup.controls.options">
                        <ul class="question-type" formArrayName="options">
                          <li
                            *ngFor="let optionCtrl of questionCtrl.controls.questionGroup.controls.options.controls let j = index">
                            <div [formGroupName]="j">
                              <div *ngIf="optionCtrl.controls['optionStatus'].value == '1'">
                                <mat-checkbox class="example-margin" [disabled]="true"></mat-checkbox>
                                <mat-form-field>
                                  <input formControlName="optionText" matInput placeholder="טקסט אפשרות"
                                    [required]="true">
                                </mat-form-field>
                                <button mat-raised-button class="mb-2" *ngIf="j>=2"
                                  (click)="removeOption(optionCtrl,i,j)" color="warn">
                                  X
                                </button>
                              </div>
                            </div>
                          </li>
                        </ul>
                        <button mat-raised-button type="button" (click)="addOption(i)"
                          class="mat-sm-button add-option-btn" color="accent"> <span class="material-icons">
                            playlist_add
                          </span></button>
                      </div>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'Text'">
                      <mat-form-field class="full-width">
                        <textarea style="resize: none;" disabled matInput placeholder="טקסט"></textarea>
                      </mat-form-field>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'TextArea'">
                      <mat-form-field class="full-width">
                        <textarea style="resize: none;" cols="3" rows="2" matInput
                          placeholder="טקסט חופשי קבוע"></textarea>
                      </mat-form-field>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'Date'">
                      <mat-form-field appearance="fill">
                        <mat-label>אפשרות תאריך</mat-label>
                        <input matInput [matDatepicker]="picker" [disabled]="true">
                        <mat-datepicker-toggle matSuffix [for]="picker">
                        </mat-datepicker-toggle>
                        <mat-datepicker #picker [disabled]="true"></mat-datepicker>
                      </mat-form-field>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'Time'">
                      <mat-form-field>
                        <input matInput disabled placeholder="00:00" />
                      </mat-form-field>
                      <ngx-material-timepicker #endTime></ngx-material-timepicker>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'Email'">
                      <mat-form-field class="full-width">
                        <textarea style="resize: none;" disabled matInput placeholder="אימייל"></textarea>
                      </mat-form-field>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'Phone'">
                      <mat-form-field class="full-width">
                        <textarea style="resize: none;" disabled matInput placeholder="מספר טלפון"></textarea>
                      </mat-form-field>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'ID'">
                      <mat-form-field class="full-width">
                        <textarea style="resize: none;" disabled matInput placeholder="תעודת זהות"></textarea>
                      </mat-form-field>
                    </div>
                    <div *ngIf="questionCtrl.controls['questionType'].value == 'Signature'">
                      <mat-form-field class="full-width">
                        <textarea style="resize: none;" disabled matInput placeholder="חתימה"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                </div>
                <button mat-mini-fab color="warn" type="button" (click)="onRemoveQuestion(i)" class="poll-remove-btn">
                  X
                </button>
              </div>
            </li>
          </div>
        </ol>
        <div fxLayout="row" fxLayoutAlign="end" style="margin-bottom: 10px;">
          <button type="button" mat-raised-button style="font-weight: bold;font-size: 20px;background-color: yellow;"
            (click)="onAddQuestion()">
            <span class="material-icons">
              add_box
            </span>
          </button>
        </div>
      </div>
    </div>
  </form>

  <mat-divider></mat-divider>
  <mat-divider></mat-divider>
  <br><br>


  <form dir="rtl" [formGroup]="tableFormGroup" autocomplete="off">
    <div formArrayName="tableArray" class="table-form" *ngIf="surveyForm.controls['TableForm'].value == '1'">
      <h3 class="text-right">יצירת טופס מסוג טבלה</h3>

      <ol class="list-style">
        <div class="row">
          <li class="col-lg-12 col-sm-12"
            *ngFor="let tableCtrl of tableFormGroup.get('tableArray')['controls']; let f = index">
            <div [formGroupName]="f" class="border-me" *ngIf="tableCtrl.controls['TableStatus'].value == '1'">
              <h4 class="text-right">טבלה מספר {{tableCtrl.controls['TablePriority'].value}}</h4>
              <div class="row">
                <div class="form-group col-9">
                  <mat-form-field appearance="fill">
                    <mat-label>כותרת לטבלה</mat-label>
                    <textarea matInput formControlName="TableText" type="textArea" rows="2"></textarea>
                  </mat-form-field>
                </div>
                <div class="form-group col-3">
                  <mat-form-field appearance="fill">
                    <mat-label>מספר טבלה</mat-label>
                    <input matInput formControlName="TablePriority" type="text">
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-12">
                  <mat-form-field appearance="fill">
                    <mat-label>תת כותרת לטבלה</mat-label>
                    <textarea matInput formControlName="SubTitle" type="textArea" rows="2"></textarea>
                  </mat-form-field>
                </div>
              </div>
              <!-- <div class="row"> -->
              <div class="form-group col-12"
                *ngFor="let tablecol of tableCtrl.controls.colsGroup.controls.column.controls; let j = index">
                <div *ngIf="tablecol.controls['colStatus'].value == '1'">
                  <div formArrayName="colsGroup">
                    <div formArrayName="column">
                      <div [formGroupName]="j">
                        <div class="row">
                          <div class="col-6">
                            <mat-form-field appearance="fill">
                              <mat-label>כותרת עמודה</mat-label>
                              <input matInput type="text" formControlName="colsText">
                            </mat-form-field>
                          </div>
                          <div class="col-6">
                            <mat-form-field class="full-width">
                              <mat-select formControlName="ColType" placeholder="סוג עמודה"
                                [required]="true">
                                <mat-option *ngFor="let type of columnType" [value]="type.value">
                                  {{type.viewValue}}
                                </mat-option>
                              </mat-select>
                            </mat-form-field>
                          </div>
                        </div>
                        <button mat-raised-button class="mb-2" (click)="removeColumn(f,j)" color="warn">
                          X
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group col-3">
                <button mat-raised-button type="button" (click)="addCols(f)" class="mat-sm-button add-option-btn"
                  color="accent"> <span class="material-icons">
                    playlist_add
                  </span></button>
              </div>
              <!-- </div> -->

              <mat-divider></mat-divider>

              <!-- <div class="row"> -->
              <div class="form-group col-3"
                *ngFor="let tablerow of tableCtrl.controls.rowsGroup.controls.row.controls; let k = index">
                <div *ngIf="tablerow.controls['rowStatus'].value == '1'">
                  <div formArrayName="rowsGroup">
                    <div formArrayName="row">
                      <div [formGroupName]="k">
                        <mat-form-field appearance="fill">
                          <mat-label>כותרת שורה</mat-label>
                          <input matInput type="text" formControlName="rowsText">
                        </mat-form-field>
                        <button mat-raised-button class="mb-2" (click)="removeRow(f,k)" color="warn">
                          X
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group col-3">
                <button mat-raised-button type="button" (click)="addRows(f)" class="mat-sm-button add-option-btn"
                  color="accent"> <span class="material-icons">
                    playlist_add
                  </span></button>
              </div>
              <!-- </div> -->
              <button mat-mini-fab color="warn" type="button" (click)="onRemoveTable(f)" class="poll-remove-btn">
                X
              </button>
            </div>
          </li>
        </div>
      </ol>
      <div fxLayout="row" fxLayoutAlign="end" style="margin-bottom: 10px;">
        <button type="button" mat-raised-button style="font-weight: bold;font-size: 20px;background-color: yellow;"
          (click)="onAddTable()">
          <span class="material-icons">
            add_box
          </span>
        </button>
      </div>
    </div>
  </form>



  <div class="button-row">
    <button class="full-width mb-5" (click)="onSubmit()" style="font-weight: bold;font-size: 20px;color: white;"
      color="primary" type="submit" mat-raised-button>
      <span>שמירת טופס</span>
    </button>
  </div>

  <!-- <div class="button-row">
    <button class="full-width mb-5" style="background-color: red;font-size: 20px;font-weight: bold;color: white;" (click)="cancelReturn()" type="submit" mat-raised-button>
      <span>ביטול וחזרה לרשימה</span>
    </button>
  </div> -->
</mat-card>