<div class="survey-options" *ngIf="!_choosed">
    <div class="poll-options">
        <div class="row">
            <div class="col-12" *ngFor="let comp of all_complaints_filter" (click)="getAndSendMessages(comp.Row_ID)">
                <mat-card class="card m-2 text-center">
                    <div class="list-style text-center" style="font-size: 10px;">:מחלקה רלוונטית</div>
                    <div class="list-style text-center" style="font-size: 15px; font-weight: bold;">
                        {{comp.Comp_Department}}</div>
                </mat-card>
            </div>
        </div>
    </div>
</div>

<form dir="rtl" [formGroup]="messanger" autocomplete="off" *ngIf="_choosed">
    <mat-card class="full-width text-center pb-0 mb-3">
        <div class="row">
            <div class="col-6">
                <label style="font-size: 20px;">{{ComplaintSubject}}</label>
            </div>
            <div class="col-5" *ngIf="UserName == 'matias'">
                <form class="example-form">
                    <mat-form-field class="example-full-width">
                        <mat-label>קישור אחראי לפנייה</mat-label>
                        <input type="text" aria-label="manager" matInput [formControl]="myControl"
                            [matAutocomplete]="auto">
                        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                            <mat-option *ngFor="let data of filteredOptions | async">
                                <div (click)="optionClicked($event, data)">
                                    <mat-checkbox [checked]="data.selected" (change)="toggleSelection(data)"
                                        (click)="$event.stopPropagation()">
                                        {{ data.firstname }}
                                    </mat-checkbox>
                                </div>
                            </mat-option>
                            <!-- <mat-option *ngFor="let option of filteredOptions | async"
                                [value]="option">{{option.name}}
                            </mat-option> -->
                        </mat-autocomplete>
                    </mat-form-field>
                </form>
            </div>
            <div class="col-1" *ngIf="UserName == 'matias'">
                <button mat-raised-button class="btn btn-primary btn-raised float-left"
                    (click)="shareComplaintWithOthers()" matTooltip="קישור מנהל לפנייה">
                    <span class="material-icons">
                        reply
                    </span>
                </button>
            </div>
        </div>

    </mat-card>
    <div class="full-width" *ngFor="let message of messagesArray">
        <mat-card class="message-card full-width" *ngIf="message.UserName != UserName">
            <p style="float: right;">{{message.FirstName}} {{message.LastName}}</p>
            <p>תאריך: {{message.MessageDate}} שעה: {{message.MessageTime}}</p>
            <p style="margin-bottom: 1rem;float: right;">{{message.MessageValue}}</p>
        </mat-card>
        <mat-card class="message-card2 full-width" *ngIf="message.UserName == UserName">
            <span class="material-icons" (click)="deleteMessage(message.Row_ID,message.Complaint)">
                delete
            </span>
            <p style="float: right;">{{message.FirstName}} {{message.LastName}}</p>
            <p>תאריך: {{message.MessageDate}} שעה: {{message.MessageTime}}</p>
            <p style="margin-bottom: 1rem;float: right;">{{message.MessageValue}}</p>
        </mat-card>
    </div>

    <mat-form-field>
        <input matInput formControlName="MessageValue" autocomplete="off" placeholder="הקלד תגובה" name="fliterVal" />
    </mat-form-field>
    <div class="button-row">
        <button class="full-width mb-5" style="font-weight: bold;font-size: 20px;color: white;" color="primary"
            (click)="getAndSendMessages(complaintID)" type="submit" mat-raised-button>
            <span>שלח תגובה</span>
        </button>
    </div>
</form>