<mat-card class="form-amen">
  <form dir="rtl" [formGroup]="caseNumberForm" autocomplete="off" *ngIf="withCaseNumber">

    <!-- <zxing-scanner [torch]="torchEnabled" [device]="deviceCurrent" (deviceChange)="onDeviceChange($event)" (scanSuccess)="onCodeResult($event)"
    [formats]="formatsEnabled" [tryHarder]="tryHarder" (permissionResponse)="onHasPermission($event)"
    (camerasFound)="onCamerasFound($event)" (torchCompatible)="onTorchCompatible($event)"></zxing-scanner> -->
    <div class="row">
      <div class="col-12">
        <mat-form-field class="full-width">
          <input formControlName="CaseNumber" matInput placeholder="מספר מקרה">
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      או
    </div>
    <div class="row">
      <div class="col-12">
        <mat-form-field class="full-width">
          <input formControlName="Passport" matInput placeholder="תעודת זהות">
        </mat-form-field>
      </div>
    </div>

    <button mat-raised-button ml-2 type="submit" (click)="searchCaseNumber()" class="btn btn-primary btn-raised mb-2"
      matTooltip="חפש">
      <span class="material-icons">
        done
      </span>
    </button>
    <button mat-mini-fab color="warn" type="button" (click)="onClose()" class="poll-remove-btn"
      matTooltip="סגירה ללא שמירה">
      X
    </button>
  </form>


  <form dir="rtl" [formGroup]="surveyForm" autocomplete="off" *ngIf="!withCaseNumber">
    <mat-card class="full-width text-center">
      <label>{{_formName}}</label>
    </mat-card>
    <div class="survey-options w-100100 float-right">
      <div class="poll-options">
        <div class="row mt-3">
          <div class="col-6 text-center">
            תאריך : {{date}}
          </div>
          <div class="col-4 text-center">
            שעה : {{time}}
          </div>
        </div>
        <div class="row">
          <div class="d-block">
            <div class="full-width mt-3 mb-3" style="white-space: pre-wrap;text-align-last: right;text-align: right;">
              {{_formOpenText}}
            </div>
          </div>
        </div>
        <ol formArrayName="Answers" class="list-style fix-jmal">
          <div class="row">
            <li
              [ngClass]="{'col-md-12 col-xs-12 col-sm-12': questionCtrl.QuestionType == 'TextArea', ' col-md-6 col-xs-12 col-sm-6' : questionCtrl.QuestionType != 'TextArea' }"
              *ngFor="let questionCtrl of _questionArr; let i=index">
              <div class="d-block" *ngIf="questionCtrl.QuestionType == 'TextArea'">
                <div class="full-width mt-3 mb-3"
                  style="white-space: pre-wrap;text-align-last: right;text-align: right;">
                  {{questionCtrl.QuestionValue}}
                </div>
              </div>
              <mat-card [formGroupName]="i" class="d-block" *ngIf="questionCtrl.QuestionType != 'TextArea'">
                <span class="pos-me-number-li">{{ i + 1}} . </span>
                <div class="row">
                  <div class="col-12 text-right">
                    <label
                      style="white-space: pre-wrap;text-align-last: right;text-align: right;">{{questionCtrl.QuestionValue}}</label>
                  </div>
                  <div class="col-12 text-right">
                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'RadioButton'">
                      <mat-radio-group class="example-radio-group" formControlName="answerContent">
                        <div class="d-block" *ngFor="let optionCtrl of questionCtrl.Options; let j = index">
                          <!-- <div class="d-block" *ngIf="optionCtrl.QuestionIDFK == questionCtrl.QuestionID"> -->
                          <mat-radio-button style="float: right;" value="{{optionCtrl.OptionValue}}">
                            {{optionCtrl.OptionValue}}</mat-radio-button>
                          <!-- </div> -->
                        </div>
                      </mat-radio-group>
                    </div>
                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'CheckBox'">
                      <mat-radio-group>
                        <div class="d-block" *ngFor="let optionCtrl of questionCtrl.Options; let k = index"
                          [formGroupName]="k">
                          <!-- <div class="d-block" *ngIf="optionCtrl.QuestionIDFK == questionCtrl.QuestionID"> -->
                          <mat-checkbox class="example-margin" formControlName="answerContent" style="float: right;"
                            value="{{optionCtrl.OptionValue}}"
                            (change)="myModel($event,optionCtrl.OptionValue,questionCtrl.QuestionID)">
                            {{optionCtrl.OptionValue}}</mat-checkbox>
                          <!-- </div> -->
                        </div>
                      </mat-radio-group>
                    </div>
                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'Text'">
                      <mat-form-field class="full-width">
                        <input matInput formControlName="answerContent" type="text">
                      </mat-form-field>
                    </div>

                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'Date'">
                      <mat-form-field appearance="fill">
                        <mat-label>אפשרות תאריך</mat-label>
                        <input matInput formControlName="answerContent" [matDatepicker]="picker">
                      </mat-form-field>
                      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                    </div>
                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'Time'">
                      <mat-form-field>
                        <input matInput [ngxTimepicker]="endTime" [format]="24" formControlName="answerContent" />
                      </mat-form-field>
                      <ngx-material-timepicker #endTime></ngx-material-timepicker>
                    </div>
                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'Email'">
                      <mat-form-field class="full-width">
                        <input formControlName="answerContent" matInput type="email">
                      </mat-form-field>
                    </div>
                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'Phone'">
                      <mat-form-field class="full-width">
                        <input formControlName="answerContent" matInput>
                      </mat-form-field>
                    </div>
                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'ID'">
                      <mat-form-field class="full-width">
                        <input formControlName="answerContent" matInput>
                      </mat-form-field>
                    </div>
                    <div class="d-block" *ngIf="questionCtrl.QuestionType == 'Signature'">
                      <img width="215" height="120" [src]="sign">
                      <button class="full-width mb-5" style="font-weight: bold;font-size: 20px;color: white;"
                        color="warn" (click)="openSignatureDialog(questionCtrl.QuestionID)" type="submit"
                        mat-raised-button>
                        <span>לחתום</span>
                      </button>
                    </div>
                  </div>
                </div>
              </mat-card>
            </li>
          </div>
        </ol>

        <div formArrayName="Tables" *ngIf="_tableForm == '1'">
          <div class="d-block">
            <h3 style="text-align: right;"><strong>חלק טבלאות</strong></h3>
          </div>
          <div class="d-block" *ngFor="let table of _tableArr; let tableIndex = index" [formGroupName]="tableIndex"
            style="margin-top: 20px;">
            <mat-divider></mat-divider>
            <div class="row">
              <h4 style="text-align: center;font-size: xx-large;font-weight: bold;">{{table.TableText}}</h4>
            </div>
            <mat-divider></mat-divider>
            <div class="row">
              <h4 style="text-align: center;font-size: 22px;">{{table.SubTitle}}</h4>
            </div>
            <div formArrayName="ColumnRows" class="row" id="table-overflow">
              <div class="col">
                <table class="table responsive-table">
                  <tr>
                    <th *ngFor="let column of table.colsGroup" style="text-align: center;">
                      {{column.colsText}}
                    </th>
                  </tr>
                  <tr *ngFor="let row of table.rowsGroup; let output = index" [formGroupName]="output">
                    <td *ngFor="let column of table.colsGroup; let output2 = index" formArrayName="Columns">
                      <span *ngIf="row.rowsText != '' && output2 == 0;else input_other"
                        style="text-align: right;float: right;">{{row.rowsText}}</span>
                      <ng-template #input_other>
                        <mat-form-field [formGroupName]="output2" *ngIf="column.ColType == 'Time'">
                          <input matInput [ngxTimepicker]="endTime" [format]="24"
                            formControlName="tableAnswerContent" />
                          <ngx-material-timepicker #endTime></ngx-material-timepicker>
                        </mat-form-field>

                        <mat-form-field appearance="fill" [formGroupName]="output2" *ngIf="column.ColType == 'Date'">
                          <mat-label>תאריך</mat-label>
                          <input matInput formControlName="tableAnswerContent" [matDatepicker]="picker">
                          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                          <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                        <mat-form-field class="fix-my-width" [formGroupName]="output2" *ngIf="column.ColType == 'Text'">
                          <input matInput formControlName="tableAnswerContent" class="table-form-input">
                        </mat-form-field>
                        <section class="example-section" [formGroupName]="output2" *ngIf="column.ColType == 'CheckBox'">
                          <mat-radio-group>
                            <mat-checkbox class="list-title m-3 text-center" formControlName="tableAnswerContent">
                            </mat-checkbox>
                          </mat-radio-group>
                        </section>
                        <div class="d-block text-center" *ngIf="column.ColType == 'Signature'">
                          <img [src]="sign" style="width: 100px;height: 60px;float: right;">
                          <button class="full-width mb-5"
                            style="font-weight: bold;font-size: 20px;color: white;width: 100%;" color="warn"
                            (click)="openSignatureDialog(column.Row_ID)" type="submit" mat-raised-button>
                            <span>לחתום</span>
                          </button>
                        </div>
                      </ng-template>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- <div class="full-width mb-2">
      <div class="row" style="text-align: right;">חתימה</div>
      <canvas class="row" #canvas id="canvas"></canvas>
      <button mat-raised-button color="secondary" style="float: right;" type="button" (click)="resetSign()"><span>תיקון
          חתימה</span></button>
    </div> -->
    <!-- <div class="button-row">
      <button class="full-width mb-5" style="font-weight: bold;font-size: 20px;color: black;" color="primary"
        (click)="fillForm(1)" type="submit" mat-raised-button>
        <span>להמשיך מאוחר יותר</span>
      </button>
    </div> -->
    <div class="button-row">
      <button class="full-width mb-5" style="font-weight: bold;font-size: 20px;color: white;" color="primary"
        (click)="onSubmit()" type="submit" mat-raised-button>
        <span>סיום ושמירת טופס</span>
      </button>
    </div>
    <div class="button-row">
      <button class="mb-5" style="font-weight: bold;font-size: 20px;color: white;float: left;" color="warn"
        (click)="onClose()" type="submit" mat-raised-button>
        <span>יציאה ללא שמירה</span>
      </button>
    </div>
  </form>
</mat-card>